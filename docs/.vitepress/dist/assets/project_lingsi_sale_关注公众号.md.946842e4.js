import{_ as s,o as a,c as l,S as n}from"./chunks/framework.e036d9b7.js";const C=JSON.parse('{"title":"关注公众号","description":"","frontmatter":{"0":"t","1":"i","2":"t","3":"l","4":"e","5":" ","6":"关","7":"注","8":"公","9":"众","10":"号"},"headers":[],"relativePath":"project/lingsi/sale/关注公众号.md","filePath":"project/lingsi/sale/关注公众号.md","lastUpdated":null}'),p={name:"project/lingsi/sale/关注公众号.md"},o=n(`<h1 id="关注公众号" tabindex="-1">关注公众号 <a class="header-anchor" href="#关注公众号" aria-label="Permalink to &quot;关注公众号&quot;">​</a></h1><p>客户提出需求：本项目中的提现功能需要用户关注公众号，只有关注了公众号后才能提现佣金。</p><h2 id="思路" tabindex="-1">思路 <a class="header-anchor" href="#思路" aria-label="Permalink to &quot;思路&quot;">​</a></h2><p>首先需要判断用户是否关注了公众号，这里后端写好了一个接口，通过调用接口获取用户关注公众号的数据；如果用户没有关注公众号，则返回 <code>null</code> 。</p><p>接着需要引导用户关注公众号，这里有几个实现思路：</p><ul><li><p>贴上公众号二维码让用户自行复制图片长按识别二维码</p></li><li><p>小程序官方提供的公众号关注组件 <code>official-account</code></p></li><li><p>给予公众号名称让用户搜索关注</p></li><li><p>客服消息</p><p>通过为按钮组件设置类型为客服类型，开启会话内信息卡片 <code> show-message-card</code> （注意只有 <code>open-type=&quot;contact&quot;</code> 时有效），效果如下图所示：</p><p><a href="https://imgse.com/i/p9I2l9K" target="_blank" rel="noreferrer"><img src="https://s1.ax1x.com/2023/05/22/p9I2l9K.jpg" alt="p9I2l9K.jpg"></a></p></li></ul><h2 id="条件" tabindex="-1">条件 <a class="header-anchor" href="#条件" aria-label="Permalink to &quot;条件&quot;">​</a></h2><p>本案例实现方式为第二点，通过官网提供的关注公众号组件。官网指路 <a href="https://developers.weixin.qq.com/miniprogram/dev/component/official-account.html" target="_blank" rel="noreferrer">official-account</a> 。</p><p>根据官网描述，关注公众号组件显示场景如下：</p><p>公众号关注组件。当用户扫<a href="https://developers.weixin.qq.com/miniprogram/dev/framework/open-ability/qr-code.html?t=19032815" target="_blank" rel="noreferrer">小程序码</a>打开小程序时，开发者可在小程序内配置公众号关注组件，方便用户快捷关注公众号，可嵌套在原生组件内。</p><p>小程序场景值命中以下值时，可展示关注公众号组件：</p><ol><li>1011 扫描二维码</li><li>1017 前往小程序体验版的入口页</li><li>1025 扫描一维码</li><li>1047 扫描小程序码</li><li>1124 扫“一物一码”打开小程序</li></ol><p>小程序热启动场景值命中以下值时，冷启动场景值在【1011、1017、1025、1047、1124】中，可展示关注公众号组件：</p><ol><li>1001 发现栏小程序主入口，「最近使用」列表</li><li>1038 从另一个小程序返回</li><li>1041 从插件小程序返回小程序</li><li>1089 微信聊天主界面下拉，「最近使用」栏</li><li>1090 长按小程序右上角菜单唤出最近使用历史</li><li>1104 微信聊天主界面下拉，「我的小程序」栏</li><li>1131 浮窗</li><li>1187 新版浮窗，微信8.0起</li></ol><p>微信开发工具调试需要修改编译条件，如下所示：</p><p><a href="https://imgse.com/i/p9IyYFK" target="_blank" rel="noreferrer"><img src="https://s1.ax1x.com/2023/05/22/p9IyYFK.png" alt="p9IyYFK.png"></a></p><blockquote><p>注意</p><p>在使用组件前，需要前往小程序后台，在“设置”-&gt;“关注公众号”中设置要展示的公众号。</p><p><a href="https://imgse.com/i/p9I6m7t" target="_blank" rel="noreferrer"><img src="https://s1.ax1x.com/2023/05/22/p9I6m7t.png" alt="p9I6m7t.png"></a></p></blockquote><h2 id="实现" tabindex="-1">实现 <a class="header-anchor" href="#实现" aria-label="Permalink to &quot;实现&quot;">​</a></h2><p>复制组件粘贴到 <code>.vue</code> 组件中，调用接口判断用户是否关注了公众号。当用户点击关注按钮后重新调用接口刷新关注状态，隐藏该组件。</p><div class="language-vue"><button title="Copy Code" class="copy"></button><span class="lang">vue</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">template</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">	</span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">official-account</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">v-if</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">!follow</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">@load</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">bindload</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">class</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">official-account</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">&gt;&lt;/</span><span style="color:#F07178;">official-account</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#89DDFF;">&lt;/</span><span style="color:#F07178;">template</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">script</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">	</span><span style="color:#82AAFF;">userFollowFn</span><span style="color:#A6ACCD;">() </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">		</span><span style="color:#89DDFF;">this.</span><span style="color:#A6ACCD;">$u</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">api</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">MineApi</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">userFollowApi</span><span style="color:#F07178;">()</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">then</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;font-style:italic;">res</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">			</span><span style="color:#89DDFF;">this.</span><span style="color:#A6ACCD;">follow</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">res</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">data</span></span>
<span class="line"><span style="color:#F07178;">		</span><span style="color:#89DDFF;">}</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">	</span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">&lt;/</span><span style="color:#F07178;">script</span><span style="color:#89DDFF;">&gt;</span></span></code></pre></div><p>问题一：关注公众号没有点击确定按钮的回调，如何判断用户何时点击确定或取消。</p><p>我们需要在用户点击确定或取消后判断用户是否关注了公众号，关注了之后才隐藏关注公众号组件。但是为了防止小程序恶意让用户关注公众号，没有推出回调函数确定或取消按钮的回调。</p><p>通过百度查询，发现点击了确定或取消按钮后会触发 <code>onShow</code> 生命周期回调函数，因此可以在 <code>onShow</code> 上调用一次接口即可。</p><p>问题二：触发 <code>onShow</code> 后立即调用接口数据不是最新的值，退出页面再进入才是最新的值。</p><p>这是因为后端接口那边也需要时间去更新最新状态，因此可以加一个延时器调用接口即可。</p><div class="language-vue"><button title="Copy Code" class="copy"></button><span class="lang">vue</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">template</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">	</span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">official-account</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">v-if</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">!follow</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">@load</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">bindload</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">class</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">official-account</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">&gt;&lt;/</span><span style="color:#F07178;">official-account</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#89DDFF;">&lt;/</span><span style="color:#F07178;">template</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">script</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">	</span><span style="color:#89DDFF;font-style:italic;">export</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;font-style:italic;">default</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">		</span><span style="color:#F07178;">onShow</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">			</span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">!this.</span><span style="color:#A6ACCD;">follow</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">				</span><span style="color:#82AAFF;">setTimeout</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">()</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">					</span><span style="color:#89DDFF;">this.</span><span style="color:#82AAFF;">userFollowFn</span><span style="color:#F07178;">()</span></span>
<span class="line"><span style="color:#F07178;">				</span><span style="color:#89DDFF;">},</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">5000</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">			</span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">		</span><span style="color:#89DDFF;">},</span></span>
<span class="line"><span style="color:#A6ACCD;">		</span><span style="color:#F07178;">methods</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">			</span><span style="color:#676E95;font-style:italic;">// 判断用户是否关注公众号</span></span>
<span class="line"><span style="color:#A6ACCD;">			</span><span style="color:#F07178;">userFollowFn</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">				</span><span style="color:#89DDFF;">this.</span><span style="color:#A6ACCD;">$u</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">api</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">MineApi</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">userFollowApi</span><span style="color:#F07178;">()</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">then</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;font-style:italic;">res</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">					</span><span style="color:#89DDFF;">this.</span><span style="color:#A6ACCD;">follow</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">res</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">data</span></span>
<span class="line"><span style="color:#F07178;">				</span><span style="color:#89DDFF;">}</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">			</span><span style="color:#89DDFF;">},</span></span>
<span class="line"><span style="color:#A6ACCD;">		</span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#A6ACCD;">	</span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">&lt;/</span><span style="color:#F07178;">script</span><span style="color:#89DDFF;">&gt;</span></span></code></pre></div>`,26),t=[o];function e(c,r,F,D,y,i){return a(),l("div",null,t)}const d=s(p,[["render",e]]);export{C as __pageData,d as default};
