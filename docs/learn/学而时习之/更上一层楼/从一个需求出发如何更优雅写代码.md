# 从一个需求出发如何更优雅写代码

## 需求分析

下面来看一个需求：

1. 四个商品推荐栏目，问题在于，四个栏目基本样式都一样，但是文字部分不一样。
2. 颜色和排行类型，写死固定，比如热销排行，固定第一个红色，第二个橘色，利润排行固定粉色，低价好物固定灰色。
3. 数据一起返回。用循环展示四个商品栏目，数据结构里只有栏目名字，栏目商品的售价和利润率。

![效果图](https://pic.imgdb.cn/item/66004ada9f345e8d03dd7442.png)

接着看一下后端的数据返回的数据，是通过一个接口返回一个数组对象，都存放着标题、商品价格、商品利润和商品地址。

```js
let data =[
    {
        title: '热销排行',
        goodsData: [
            {
                price: '100.0',
                profit: 30,
                src: ''
            },
            {
                price: '78.0',
                profit: 20,
                src: ''
            },
        ]
    },
    {
        title: '利润排行',
        goodsData: [
            {
                price: '30.0',
                profit: 130,
                src: ''
            },
            {
                price: '333.0',
                profit: 55,
                src: ''
            },
        ]
    },
    {
        title: '热门主题',
        goodsData: [
            {
                price: '137.0',
                src: ''
            },
            {
                price: '78.0',
                src: ''
            },
        ]
    },
    {
        title: '低价好物',
        goodsData: [
            {
                price: '100.0',
                profit: 30,
                src: ''
            },
            {
                price: '78.0',
                profit: 20,
                src: ''
            },
        ]
    }
]
```

## 思路分析

首先想到的是通过 `v-for` 渲染出四个模块出来先。

```vue
<div v-for="(item, index) in data" :key="index">
  <div>{{ item.title }}</div>
  <div>
    <div v-for="(goods, i) in item.goodsData" :key="i">
      <el-image src="" />
    </div>
  </div>
</div>
```

渲染出来效果如下所示：

![效果](https://pic.imgdb.cn/item/660246b59f345e8d03aa8b2e.png)

接下来要分析的是栏目该如何处理渲染，它分几种情况：是否渲染、渲染的颜色、渲染的文本等。

关于处理方案，此处有几个不同的思路：

1. 四个栏目写成四种文本，通过 `v-if` 判断显示哪个
2. 文本部分不同的样式文字通过函数返回
3. 利用 `jsx` 根据不同栏目渲染不同的样式
4. 修改源数据

## 实现

### v-if

首先先来看第一种通过 `v-if` 判断文本和索引，渲染不同内容和样式的元素。

```vue
<div v-for="(item, index) in data" :key="index">
  <div>{{ item.title }}</div>
  <div>
    <div v-for="(goods, i) in item.goodsData" :key="i">
      <el-image src="" />
      <div v-if="item.title==='热门排行' && i = 0" style="background: red; color: #fff;">Top1</div>
      <div v-if="item.title==='热门排行' && i = 1" style="background: orange; color: #fff;">Top2</div>
      <div v-if="item.title==='利润排行'" style="background: pink; color: #000;">{{ goods.profit }}%</div>
      <div v-if="item.title==='低价好物'" style="background: #555; color: #000;">{{ goods.price }}</div>
    </div>
  </div>
</div>
```

该方式简单粗暴，缺陷是 HTML 代码量多且冗余，后续不易维护，因此不是很推荐使用。

### 函数返回

既然 `div` 盒子内容一致，那么可以通过一个函数统一返回，减少代码量。

```vue
<script setup>
const createStyle = (title, index) => {
  let styleObj = {}
  switch(title) {
      case '热销排行': 
      	styleObj.color = '#fff'
      	if (index === 0) styleObj.background = 'red'
      	else styleObj.background = 'orange'
      	break;
      case '利润排行': 
      	styleObj.color = '#000'
      	styleObj.background = 'pink'
      	break;
      case '低价好物': 
      	styleObj.color = '#000'
      	styleObj.background = 'gray'
      	break;
      case '热门主题': 
      	styleObj.display = 'none'
      	break;
    default:
      break;
  }
}
const createText = (title, good) => {
  let txt = ''
  switch(title) {
      case '热销排行': 
      	if (index === 0) txt = 'Top1'
      	else txt = 'Top2'
      	break;
      case '利润排行': 
      	txt = good.profit + '%'
      	break;
      case '低价好物': 
      	txt = good.price
      	break;
    default:
      break;
  }
}
</script>

<div v-for="(item, index) in data" :key="index">
  <div>{{ item.title }}</div>
  <div>
    <div v-for="(goods, i) in item.goodsData" :key="i">
      <el-image src="" />
      <div :style="createStyle(item.title, i)">{{ createText(item.title, goods) }}</div>
    </div>
  </div>
</div>
```

