# 前端下载后端传输的文件

## 方法

1. 直接打开下载地址

   无法命名，只适用于 `get` 直接返回 `blob` 的接口

2. 利用 `a` 标签的 ``download` 属性

   比较合适的方案

3. 第三方库 `file-saver` 

## 直接打开

通过 `window.open()` 直接打开下载。

```js
downloadFn() {
    window.open('http://')
}
```

缺点：

1. 无法更改名称
2. 无法做 `token` 校验

## a标签下载

### 重要概念

先捋清楚几个重要概念：

- `createObjectURL` ：把 `blob` 对象的内存地址，以 `url` 形式给出
- `msSaveBlob` ：IE不支持 `a` 标签下载，用该方法代替
- `download` ：`a` 标签该属性是下载，可说明文件名

### 流程梳理

首先按 `blob` 格式请求接口接收二进制文件，然后判断是否有 `msSaveBlob` 。

#### 有msSaveBlob

用 `msSaveBlob` 下载。

#### 无msSaveBlob

- `createObjectURL` 创建文件本地 `url` 
- 创建 `a` 标签
- 创建的 `url` 给到 `a` 标签的 `href` 
- 设置 `download` （即文件名）
- 模拟点击下载
- 下载完毕，销毁 `a` 标签

### 代码实操

```js
// 按blob请求接口
axios.get('http://', {responseType: 'blob'}).then(res => {
    if(window.navigator.msSaveBlob) {
        // IE浏览器
        window.navigator.msSaveBlob(res.data, { type: 'application/vnd.openxmlformats-officedocument.presentationml.presentation' }, 'download.ppt')
    } else {
        // 非IE
        const blobURL = URL.createObjectURL(res.data) // 创建blob本地url
        const link = document.createElement('a') // 创建标签
        link.href = blobURL // 设置href
        link.download = 'download.ppt' // 设置下载的文件名
        link.style.display = 'none' // 把他隐藏
        link.click()
        link.remove()
        URL.revokeObjectURL(blobURL) // 销毁临时地址
    }
})
```

## 第三方库

- 下载

  ```
  yarn add file-saver
  ```

- 引入 `saver` 

  ```js
  import { saveAs } from 'file-saver'
  ```

- 使用

  ```js
  axios.get('http://', {responseType: 'blob'}).then(res => {
      saveAs(res.data, 'download.ppt') // 路径，名称
  })
  ```

## 拓展

下载完文件后想要展示预览该如何实现？

### 思路分析

预览无论是图片，还是 `excel`、`word` ，都需要一个地址 `url` 。

`url` 除了线上地址，还能使用 `base64` 地址。因此接收到 `blob` 地址后把它转为 `base64` 即可。

转换方法可以用到 `fileReader` 方法转换成任意我们想要的格式。