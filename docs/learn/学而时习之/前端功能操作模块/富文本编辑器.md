# 富文本编辑器

## tinymce

### 注意事项

1. 可以安装对应的 `vue/react` 组件，直接作为组件使用。或者直接下载做原生操作
2. 报找不到文件的错误，需要把 `tinymce` 复制到 `public` 文件夹内

### 安装

- 安装 vue 模块的组件

  ```
  yarn add @tinymce/tinymce-vue
  ```

  如果是 `react` 项目则改为 `@tinymce/tinymce-react` 。

- 安装 `tinymce` 包

  ```
  yarn add tinymce
  ```

### 使用

- 首先引入富文本编辑器

  ```js
  import tinymce from 'tinymce'
  ```

- 挂载到元素上

  通过 `tinymce.init()` 方法的 `selector` 属性传入一个 `id` 选择器或类选择器，表示把富文本编辑器挂载到该元素上。

  > 注意：
  >
  > 由于要获取到元素，因此需要等待元素加载完毕才能获取，`vue2` 项目中要把方法写在 `mounted` 生命周期上，`vue3` 项目要把方法写在 `onMounted` 钩子上

  ```vue
  <script setup>
  import { onMounted } from 'vue'
  
  onMounted(() => {
      tinymce.init({
          selector: '#mytinymce'
      })
  })
  </script>
  
  <template>
  	<div id="mytinymce"></div>
  </template>
  ```

- 复制文件到 `public` 文件

  此时它加载完后会试图加载它的 `js` 文件和 `css` 文件，因此要把 `node_modules` 内它的整个内容复制到 `public` 文件内。否则会报错。

  后续如果项目打包上线了，也需要把这些资源放到服务器的静态资源目录中。

### 常见界面需求

#### 隐藏不需要的部分

- 组件的方式

  引入组件

  ```js
  import { Editor } from '@tinymce/tinymce-vue'
  ```

  页面中使用

  ```vue
  <script setup>
  const initObj = {
      selector: '#mytinymce',
      Menubar: false,
      toolbar: true,
      statusbar: true,
  }
  </script>
  
  <Editor :init="initObj"></Editor>
  ```

- 直接使用`tinymce` 的方式

  `Menubar` 控制菜单，`toolbar` 控制工具栏，`statusbar` 控制状态栏。想要隐藏只需要在配置中把其设为 `false` 即可。

  ```js
  onMounted(() => {
      tinymce.init({
          selector: '#mytinymce',
          Menubar: false,
          toolbar: true,
          statusbar: true,
      })
  })
  ```

#### 自定义样式

`Skin` 控制皮肤，或者通过 `skin_url` 导入自定义皮肤。也可以通过 `content_css` 定义内容区域样式。`Icons_url` 导入图标。

皮肤在复制到 `public` 文件中的 `skin` 文件夹下 `ui` 文件夹内寻找，复制其文件夹名称即可。其本质是寻找其对应皮肤文件夹下的 `skin.css` 文件。

自定义皮肤则是在 `public` 下找到自定义的文件夹名称（如下方示例代码的 `myskin` ）下寻找 `content.min.css` 和 `skin.min.css` 文件。

```js
onMounted(() => {
    tinymce.init({
        selector: '#mytinymce',
        Menubar: false,
        toolbar: true,
        statusbar: true,
        skin: 'oxide',
        skin_url: 'myskin',
    })
})
```

#### 中文化

把文件转为二进制形式获取为 `blob` 形象。

下载中文包，解压 `langs` 文件夹到 `public` 文件夹内，在配置项中通过 `language` 属性赋值刚解压的js文件名。

```js
onMounted(() => {
    tinymce.init({
        selector: '#mytinymce',
        Menubar: false,
        toolbar: true,
        statusbar: true,
        skin: 'oxide',
        skin_url: 'myskin',
        language: 'zh-Hans',
    })
})
```

#### 自己选择工具栏内容和排序

把文件转为二进制形式获取为 `blob` 形象。

通过 `toolbar` 设置排序，用 `|` 作为组分隔开每组，每个单词对应不同的功能，从左到右对应排序。

```js
onMounted(() => {
    tinymce.init({
        selector: '#mytinymce',
        Menubar: false,
        toolbar: 'undo redo | styles | blob italic | fontfamily fontsize fontcolor',
        statusbar: true,
        skin: 'oxide',
        skin_url: 'myskin',
        language: 'zh-Hans',
    })
})
```

### 进阶需求

#### 获取内容

通过 `tinymce.activeEditor.getContent()` 获取内容。这么获取的内容是 `html` 富文本内容，如果想要获取纯文本内容，则需要在括号内设置 `{format: 'text'}` 。

#### 设置内容

通过 `tinymce.activeEditor.setContent()` 设置内容。括号内输入内容，如 `'<p>daodao</p>'` 。也可以选中内容设置内容，方法为选中内容后通过 `tinymce.activeEditor.selection.setContent('hello')` 替换为 `hello` 。

### 二次开发

#### 自带插件

在安装的时候有一个 `plugins` 文件夹，里面有它自带的插件，如image、link、code、table等。

使用方法为在 `plugins` 属性中配置插件，在 `toolbar` 中设置即可。

```js
onMounted(() => {
    tinymce.init({
        selector: '#mytinymce',
        Menubar: false,
        plugins: 'code image',
        toolbar: 'undo redo | styles | blob italic | fontfamily fontsize fontcolor | code image',
        statusbar: true,
        skin: 'oxide',
        skin_url: 'myskin',
        language: 'zh-Hans',
    })
})
```

如果引用他人的插件，把他复制到 `plugins` 文件夹下，再把文件名配置到 `plugins` 属性和 `toolbar` 属性中，就算完成。

#### 开发自己的工具栏按钮

首先通过 `setup` 函数中注册，该函数的形参可获取 `Editor` 对象，通过 `ui.registry.addButon` 方法创建按钮和功能。

该方法接收两个参数，参数1是字符串，为该按钮的名称；参数2是一个对象，icon为该按钮的图标，tooltip为提示功能，onAction是一个函数，用于设置功能。

```js
onMounted(() => {
    tinymce.init({
        selector: '#mytinymce',
        Menubar: false,
        plugins: 'code image',
        toolbar: 'undo redo | styles | blob italic | fontfamily fontsize fontcolor | code image',
        statusbar: true,
        skin: 'oxide',
        skin_url: 'myskin',
        language: 'zh-Hans',
        setup(editor) {
            // 对选中的内容做某些操作
            editor.ui.registry.addButton('red', {
                icon: 'help',
                toolTip: '字体标红',
                onAction: () => {
                    let text = editor.selection.getContent()
                    editor.selection.sgetContent(`<span class="red-text">${text}</span>`)
                }
            });
            // 把内容展示在页面中
            editor.ui.registry.addButton('show', {
            	icon: 'emjio',
            	toolTip: '展示选中内容',
            	onAction: () => {
                	let text = editor.selection.getContent()
                	popShow.value = true
            		popValue.value = text
            });
        },
        content_css: '/mycontent.css' // 大段的css样式可在 public 文件夹中创建一个css文件设置类名样式
    })
})
```

