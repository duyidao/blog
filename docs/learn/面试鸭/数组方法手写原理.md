# 数组方法手写原理

## forEach

`forEach` 主要是做循环遍历操作，接收一个回调函数，该回调函数传递三个参数：

- 参数1：该遍历项的每一项数据（即 `item` ）
- 参数2：该项的索引（即 `index` ）
- 参数3：该数组

```js
Array.prototype.my_foreach = function(callback) {
    for(let i = 0; i < this.length; i++) {
        callback(this[i], i, this)
    }
}
```

其中，这里的 `this` 指向的是使用该方法的数组（如下方示例中的 `daodao` 数组），而 `for` 循环需要获取到数组的长度，因此用到了 `this.lengh` ，每一项的数据则是 `this[i]` 。

下面使用一下自己封装好的 `my_foreach` 方法：

```js
daodao.my_foreach((item, index, arr) => {
  console.log(item, index, arr)
})
```

打印结果如下所示：

[![p9HbM2F.png](https://s1.ax1x.com/2023/05/25/p9HbM2F.png)](https://imgse.com/i/p9HbM2F)

### 拓展

使用过 `forEach` 的程序员都知道 `return` 无法终止 `forEach` 循环，现在知道其原理了，因为我们在使用的 `forEach` 里写的 `return` 是在回调函数 `callback` 中，`return` 只能跳出当前的循环，无法跳出整体的循环。

## map

`map` 主要做某种操作，并返回一个新的数组，接收一个回调函数，该回调函数传递三个参数：

- 参数1：该遍历项的每一项数据（即 `item` ）
- 参数2：该项的索引（即 `index` ）
- 参数3：该数组

```js
Array.prototype.my_map = function(callback) {
    const arr = []
    for(let i = 0; i < this.length; i++) {
        arr.push(callback(this[i], i, this)) // 此时拿到的是数组的每一条数据
    }
    return arr
}
```

由于要返回一个新数组，因此需要在循环体外先定义一个空数组，每一次循环都往数组内 `push` 一次数据，最后再 `return` 返回。

```js
const newdaodao = daodao.my_map((item, index) => {
  return {
    ...item,
    name: item.name + '，你好'
  }
})
console.log(newdaodao);
```

最后运行结果如下所示：

```js
[
    {
        "age": 20,
        "name": "刀刀，你好"
    },
    {
        "age": 21,
        "name": "小刀，你好"
    },
    {
        "age": 22,
        "name": "杜一刀，你好"
    }
]
```

## filter

`filter` 每一遍历一次回调函数都会返回一个布尔值，如果该值为真才添加到数组中，为假则不添加，接收一个回调函数，该回调函数传递三个参数：

- 参数1：该遍历项的每一项数据（即 `item` ）
- 参数2：该项的索引（即 `index` ）
- 参数3：该数组

```js
Array.prototype.my_filter = function(callback) {
    const arr = []
    for(let i = 0; i < this.length; i++) {
        // callback(this[i], i, this) && arr.push(callback(this[i], i, this)) // 这么写的话最终返回的结果是：(2) [true, true].因为此时拿到的是一个布尔值
        callback(this[i], i, this) && arr.push(this[i])
    }
    return arr
}
```

使用：

```js
const newdaodao = daodao.my_filter((item, index) => item.name.length <= 2)
console.log(newdaodao);
```

结果返回：

```js
[
    {
        "age": 20,
        "name": "刀刀"
    },
    {
        "age": 21,
        "name": "小刀"
    }
]
```

