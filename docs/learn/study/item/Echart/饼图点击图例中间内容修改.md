# 饼图点击图例中间内容修改

## 需求展示

测试在复测项目时发现饼图点击图例后中间内容并没有发生相应的改变，测试想要实现下方效果：

![效果](https://pic.imgdb.cn/item/664dbdb8d9c307b7e9e160d4.png)

查看 EChart 官方文档，发现他有一个方法  `legendselectchanged`，文档指路[Documentation - Apache ECharts](https://echarts.apache.org/zh/api.html#events.legendselectchanged) 。该方法在点击切换图例的选中状态时会触发。

## 事件绑定

为渲染图例的 DOM 元素绑定事件，代码如下

```vue
<template>
    <div ref="diseaseChartRef" class="disease-chart"></div>
</template>

<script>
import * as echarts from 'echarts';
export default {
  setup(props, {emit}) {
    const myChart = ref(null)
    const diseaseChartRef = ref(null)
    
    const init = () => {
        if (!myChart.value) return;
        myChart.value.setOption(props.option);
    }
    
    onMounted(() => {
      myChart.value = echarts.init(diseaseChartRef.value);
      myChart.value.on('legendselectchanged', function (e) {
          emit('legendselectchanged', e);
      });
      init()
    })
    
    watch(() =. props.option, () => {
      init()
    }, {deep: true, immediate: true})
    
    return {
      diseaseChartRef
    }
  }
}
</script>
```

此时就能绑定上

## 逻辑修改

查看其打印，打印结果如下：

![打印结果](https://pic.imgdb.cn/item/664dc34cd9c307b7e9e7e866.png)

拿到数据后就可以在自定义饼图中间内容的自定义函数内修改内容。代码如下所示：

```js
const initForMatter = () => {
    const obj = legendList.value.find(item => item.chose);
    const num = obj ? obj.value : 0;
    const name = obj ? obj.name : '高';
    labelFormatter.value = '{total|' + num + '%}' + '\n' + '{title|' + name + '}';
};

const legendselectchangedFn = e => {
    legendList.value = legendList.value.map(item => {
        return {
            ...item,
            chose: e.selected[item.name],
        };
    });
    initForMatter();
    setOption.value.series[0].label.normal.formatter = labelFormatter.value;
};
```

这里的逻辑是渲染第一项选中的数据，如有高、较高、中、较低、低五条数据，点击中和低后，第一项选中的数据是高，则中间内容继续渲染高。