## 一级分类

### 一级分类设置

点击顶部导航栏跳转到对应的一级分类页面，按照如下步骤：

1. 路由文件添加对应路由，这里采取把 id 添加到路由上，为必传项，因此需要 `:` 占位表示此数据为动态数据

   ```js
   const router = createRouter({
     history: createWebHistory(import.meta.env.BASE_URL),
     // path和component对应关系的位置
     routes: [
       {
         path: '/',
         component: Layout,
         children: [
           // ...
           {
             path: 'category/:id',
             component: () => import('@/views/Category/index.vue')
           },
         ]
       },
     ],
   })
   ```

2. 页面中通过 `RouterLink` 组件的 `to` 属性定义要跳转的路径，改为对应 id 即可

   ```vue
   <RouterLink :to="`category/${item.id}`">{{ item.name }}</RouterLink>
   ```

### 面包屑

面包屑导航主要步骤如下：

1. 复制粘贴静态面包屑模板
2. 封装接口函数
3. 在面包屑 `.vue` 组件中引入接口函数，获取路由上的 id 作为参数传参
4. 获取接口数据动态渲染

### 分类Banner

分类处轮播图主要步骤如下：

1. 修改封装的轮播图接口，用于接收不同的参数（首页轮播图不用传，可使用默认值）

   ```js
   export const getBannerAPI = (params = {}) => {
     const { distributionSite = '1' } = params
     return http({
       url: '/home/banner',
       params: {
         distributionSite
       }
     })
   }
   ```

2. 封装轮播图组件以复用

   ```vue
   <script setup>
   defineProps({
     bannerList: {
       type: Array,
       required: true
     },
     height: {
       type: [String, Number],
       default: 500
     }
   })
   
   /*
   * 点击轮播图
   * e：当前被点击的轮播图的数据
   */
   const handleCarouselFn = e => {
     // this.$router.push(e.hrefUrl)
   }
   </script>
   
   <template>
     <el-carousel :height="height + 'px'">
         <el-carousel-item v-for="item in bannerList" :key="item.id" @click="handleCarouselFn(item)">
           <img :src="item.imgUrl" alt="">
         </el-carousel-item>
       </el-carousel>
   </template>
   
   <style scoped>
   
   </style>
   ```

3. 分类组件中引入使用（首页轮播图也可使用复用的组件），然后单独对应参数获取对应数据即可

### 导航激活设置分类列表渲染

1. 导航激活

   点击对应导航却没有相应的激活样式，不利于用户体验。而组件 `RouterLink` 有一个属性 `active-class` ，当其 `to` 属性的值与路由的值匹配，则会处于激活状态，获取等号后的激活样式。

   ```vue
   <RouterLink active-class="active" :to="`/category/${item.id}`">{{ item.name }}</RouterLink>
   ```

   现在为 `active` 做对应的样式设置即可。

2. 分类渲染

   渲染对应内容即可。

### 路由缓存

`Vue` 官方文档有一段说明：使用带参数的路由时，当用户从 `/category/01` 跳转到 `/category/02` 时，相同的组件实例将会被重复使用，减少性能消耗。但是这也意味着生命周期钩子不会被调用。

解决思路：

1. 让组件实例不再复用，强制销毁重建
2. 监听路由变化，变化后执行数据更新操作

#### 方案一

在 `vue` 中，`:key` 不仅可以用来配合 `v-for` 使用，同时也能作用于强制替换一个元素、组件而不是复用它。

在二级路由处添加 `:key` 属性，值为当前完整路由，代码如下：

```vue
<router-view :key="$route.fullPath"></router-view>
```

刷新后查看页面，发现效果实现了，但是有一个问题，我们只需要内容区域接口重新获取，而它把不需要重新调用的轮播图接口也重复请求。如果接口多的话，这样很影响性能。

#### 方案二

`vue` 路由提供了一个方法 `onBeforeRouteUpdate` ，在路由参数发生变化时触发。其中有一个 `to` 参数，接收最新的路由参数。因此获取最新的路由参数的 `id` ，单纯调用分类接口，这样不至于消耗太大的性能。

```js
import { onBeforeRouteUpdate } from "vue-router";

/**
 * 侦听路由变化，重新调用接口
 * to：当前最新路由参数
 * */
onBeforeRouteUpdate((to) => {
  // 存在问题：使用最新的路由参数请求最新的分类数据
  getTopCategoryFn(to.params.id);
})
```

